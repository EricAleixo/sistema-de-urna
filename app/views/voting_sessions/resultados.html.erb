<% content_for :head do %>
  <%= stylesheet_link_tag "voting_sessions", media: "all" %>
<% end %>

<div class="turmas-header">
  <div class="container">
    <div class="text-center">
      <h1 class="turmas-title">RESULTADOS DAS ELEIÇÕES</h1>
      <h2 class="turmas-subtitle">Sistema de Eleições</h2>
    </div>
  </div>
</div>

<div>
  <div class="results-wrapper">
      <div class="results-header">
        <div class="results-title-area">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          <h2 class="results-title">Apuração de Votos</h2>
        </div>
        <div class="results-badge">
          <%= @candidaturas.count %> Candidatura<%= @candidaturas.count != 1 ? 's' : '' %>
        </div>
      </div>
  <% if @candidaturas.any? %>
    <div class="candidates-grid">
          <% @candidaturas.each_with_index do |candidatura, index| %>
            <div class="candidate-card <%= 'winner-card' if index == 0 && @session.status == 'closed' %>">
              <!-- Position Badge -->
              <div class="position-badge <%= 'position-first' if index == 0 %>">
                <% if index == 0 && @session.status == 'closed' %>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                <% else %>
                  <%= index + 1 %>º
                <% end %>
              </div>

              <div class="candidate-content">
                <!-- Photo -->
                <div class="candidate-photo-wrapper">
                  <% if candidatura.foto_lider.present? %>
                    <%= image_tag candidatura.foto_lider, class: "candidate-photo", alt: candidatura.nome_candidato %>
                  <% else %>
                    <div class="candidate-photo-placeholder">
                      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                      </svg>
                    </div>
                  <% end %>
                </div>

                <!-- Info -->
                <div class="candidate-info">
                  <div class="candidate-header">
                    <h3 class="candidate-name"><%= candidatura.nome_candidato %></h3>
                    <div class="ballot-name-wrapper">
                      <span class="ballot-label">Nome de urna:</span>
                      <span class="ballot-name"><%= candidatura.nome_urna %></span>
                    </div>
                  </div>

                  <div class="vice-section">
                    <div class="vice-photo-mini">
                      <% if candidatura.foto_vice.present? %>
                        <%= image_tag candidatura.foto_vice, class: "vice-photo", alt: candidatura.vice_lider %>
                      <% else %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                          <circle cx="12" cy="7" r="4"/>
                        </svg>
                      <% end %>
                    </div>
                    <div class="vice-info">
                      <span class="vice-label">Vice-líder:</span>
                      <span class="vice-name"><%= candidatura.vice_lider %></span>
                      <span class="vice-ballot">(<%= candidatura.nome_urna_vice %>)</span>
                    </div>
                  </div>
                </div>

                <!-- Stats -->
                <div class="candidate-stats-section">
                  <div class="stats-main">
                    <span class="stats-number" id="votos-<%= candidatura.id %>"><%= candidatura.votos %></span>
                    <span class="stats-label">votos</span>
                  </div>
                  <% if @total_votos > 0 %>
                    <div class="stats-percentage" id="percent-<%= candidatura.id %>">
                      <%= number_to_percentage((candidatura.votos.to_f / @total_votos * 100), precision: 1) %>
                    </div>
                    <div class="progress-bar-container">
                      <div class="progress-bar-fill" id="progress-<%= candidatura.id %>" 
                        style="width: <%= (candidatura.votos.to_f / @total_votos * 100).round(2) %>%"></div>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
        <% if @turma.votos_em_branco && @turma.votos_em_branco > 0 %>
          <div class="blank-votes-card">
            <div class="blank-icon-wrapper">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
              </svg>
            </div>
            <div class="blank-info">
              <span class="blank-title">Votos em Branco</span>
              <span class="blank-description">Eleitores que optaram por não escolher nenhum candidato</span>
            </div>
            <div class="blank-stats">
              <span class="blank-number"><%= @turma.votos_em_branco %></span>
              <% if @total_votos > 0 %>
                <span class="blank-percent">
                  <%= number_to_percentage((@turma.votos_em_branco.to_f / @total_votos * 100), precision: 1) %>
                </span>
              <% end %>
            </div>
          </div>
        <% end %>
         <% else %>
        <div class="empty-state">
          <div class="empty-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 11H3v2h6m-6 8h18v-2H3m3-6h3v2H6m5-2h9v2h-9m-3-6h18v2H3z"/>
            </svg>
          </div>
          <h3 class="empty-title">Nenhuma Candidatura Cadastrada</h3>
          <p class="empty-description">Esta turma ainda não possui candidatos registrados para a eleição.</p>
        </div>
        <%end%>
        </div>
</div>