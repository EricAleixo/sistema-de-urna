<% content_for :head do %>
  <%= stylesheet_link_tag "voting_sessions", media: "all" %>
<% end %>
<div class="voting-sessions-container">
  <div class="sessions-header">
    <div class="header-left">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 20V10"/>
          <path d="M12 20V4"/>
          <path d="M6 20v-6"/>
        </svg>
      </div>
      <div class="header-content">
        <h1 class="page-title">Sessões de Votação</h1>
        <p class="page-subtitle">Gerencie e acompanhe todas as votações</p>
      </div>
    </div>
    <div class="candidatura-action-container">
      <%= link_to "mesario/selecionar_turma", class: "btn-nova-candidatura" do %>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <line x1="19" y1="8" x2="19" y2="14"></line>
          <line x1="22" y1="11" x2="16" y2="11"></line>
        </svg>
        <span>Nova Sessão</span>
      <% end %>
    </div>
  </div>

  <% if @voting_session.empty? %>
    <div class="sessions-empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
        </svg>
      </div>
      <h3 class="empty-title">Nenhuma sessão criada ainda</h3>
      <p class="empty-description">Comece criando sua primeira sessão de votação para gerenciar eleições de líderes e vice-líderes</p>
      <%= link_to "mesario/selecionar_turma", class: "btn-empty-action" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="16"/>
          <line x1="8" y1="12" x2="16" y2="12"/>
        </svg>
        Criar Primeira Sessão
      <% end %>
    </div>
  <% else %>
    <div class="sessions-grid">
      <% @voting_session.each do |session| %>
        <div class="session-card <%= 'session-active' if session.open? %>">
          <div class="session-card-header">
            <div class="session-meta">
              <span class="session-id">#<%= session.id %></span>
              <div class="status-badge <%= session.status %>">
                <span class="status-dot"></span>
                <span class="status-text">
                  <% case session.status %>
                  <% when "open" %>
                    Aberta
                  <% when "closed" %>
                    Encerrada
                  <% when "paused" %>
                    Pausada
                  <% end %>
                </span>
              </div>
            </div>
            <div class="session-actions">
              <%= link_to voting_session_path(session), class: "btn-action-primary btn-view-details", title: "Ver detalhes" do %>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              <% end %>
              <%= button_to voting_session_path(session), 
                  method: :delete, 
                  data: { 
                    turbo_confirm: "Tem certeza que deseja excluir esta sessão?" 
                  }, 
                  class: "btn-action btn-delete", 
                  title: "Excluir",
                  form: { style: "display: inline;" } do %>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              <% end %>
            </div>
          </div>

          <div class="session-turma-info">
            <div class="turma-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <div class="turma-details">
              <span class="turma-label">Turma</span>
              <h3 class="turma-name"><%= session.turma.nome %></h3>
            </div>
          </div>

          <div class="session-stats">
            <div class="stat-item">
              <div class="stat-icon candidates-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="8.5" cy="7" r="4"/>
                  <line x1="20" y1="8" x2="20" y2="14"/>
                  <line x1="23" y1="11" x2="17" y2="11"/>
                </svg>
              </div>
              <div class="stat-content">
                <span class="stat-value"><%= session.turma.candidaturas.count %></span>
                <span class="stat-label">Candidatos</span>
              </div>
            </div>

            <div class="stat-divider"></div>

            <div class="stat-item">
              <div class="stat-icon votes-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              </div>
              <div class="stat-content">
                <span class="stat-value"><%= session.turma.candidaturas.sum(:votos) %></span>
                <span class="stat-label">Votos</span>
              </div>
            </div>
          </div>

          <% if session.turma.candidaturas.any? && session.status == "closed" %>
            <div class="candidates-preview">
              <div class="preview-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 20V10"/>
                  <path d="M18 20V4"/>
                  <path d="M6 20v-4"/>
                </svg>
                <span>Principais Candidatos</span>
              </div>
              <div class="candidates-list">
                <% session.turma.candidaturas.order(votos: :desc).limit(2).each_with_index do |candidatura, index| %>
                  <div class="candidate-mini <%= 'leading' if index == 0 %>">
                    <div class="candidate-avatars-group">
                      <div class="candidate-avatar main-avatar">
                        <% if candidatura.foto_lider.present? %>
                          <%= image_tag candidatura.foto_lider, alt: candidatura.nome_candidato, class: "avatar-img" %>
                        <% else %>
                          <div class="avatar-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                              <circle cx="12" cy="7" r="4"/>
                            </svg>
                          </div>
                        <% end %>
                        <% if index == 0 %>
                          <div class="leading-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                          </div>
                        <% end %>
                      </div>
                      <% if candidatura.vice_lider.present? %>
                        <div class="candidate-avatar vice-avatar" title="<%= candidatura.vice_lider %>">
                          <% if candidatura.foto_vice.present? %>
                            <%= image_tag candidatura.foto_vice, alt: candidatura.vice_lider, class: "avatar-img" %>
                          <% else %>
                            <div class="avatar-placeholder vice-placeholder">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                              </svg>
                            </div>
                          <% end %>
                          <div class="vice-indicator">V</div>
                        </div>
                      <% end %>
                    </div>
                    <div class="candidate-mini-info">
                      <span class="candidate-mini-name"><%= candidatura.nome_urna %></span>
                      <% if candidatura.vice_lider.present? %>
                        <span class="candidate-vice-name">
                          <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"/>
                          </svg>
                          <%= candidatura.nome_urna_vice.present? ? candidatura.nome_urna_vice : candidatura.vice_lider %>
                        </span>
                      <% end %>
                      <span class="candidate-mini-votes">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        <%= candidatura.votos %> votos
                      </span>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          <div class="session-footer">
            <div class="session-date">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span>Criada em <%= l(session.created_at, format: :short) %></span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>